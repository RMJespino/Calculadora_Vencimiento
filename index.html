<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Vencimiento</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(135deg, #9d50bb, #6e48aa);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
    }
    .titulo {
      font-weight: 600;
      color: #6e48aa;
      text-align: center;
    }
    .firma {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 0.9em;
      color: #ffffff;
      opacity: 0.7;
    }
    .firma:hover {
      opacity: 1;
    }
    .alert-success {
      background-color: #d9ede1;
      border: 1px solid #c1dccd;
      color: #333333;
      font-size: 1rem;
    }
    .fecha-final {
      font-size: 2.2rem;
      font-weight: 700;
      color: #6e48aa;
      text-align: center;
      margin: 10px 0;
    }
    .texto-detalle {
      text-align: justify;
      color: #333333;
    }
    .resultado-bloque {
      text-align: center;
      margin-bottom: 20px;
    }
    .etiqueta {
      font-weight: 600;
      color: #444;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2 class="titulo mb-4">Calculadora de Fecha de Vencimiento</h2>

    <!-- Selector de producto -->
    <div class="mb-3">
      <label for="producto" class="form-label">Selecciona el producto:</label>
      <select class="form-select" id="producto" onchange="mostrarCampos()">
        <option value="">-- Elegir --</option>
        <option value="Anchor">Anchor</option>
        <option value="Gloria">Gloria</option>
      </select>
    </div>

    <!-- Campos Anchor -->
    <div id="camposAnchor" class="d-none">
      <div class="mb-3">
        <label for="envasadoA" class="form-label">Fecha de envasado:</label>
        <input type="date" class="form-control" id="envasadoA" />
      </div>
      <div class="mb-3">
        <label for="vitaminaA" class="form-label">Fecha de vencimiento de la vitamina:</label>
        <input type="date" class="form-control" id="vitaminaA" />
      </div>
    </div>

    <!-- Campos Gloria -->
    <div id="camposGloria" class="d-none">
      <div class="mb-3">
        <label for="fabricacionB" class="form-label">Fecha de envasado:</label>
        <input type="date" class="form-control" id="fabricacionB" />
      </div>
      <div class="mb-3">
        <label for="conservanteB" class="form-label">Fecha de vencimiento del granel:</label>
        <input type="date" class="form-control" id="conservanteB" />
      </div>
    </div>

    <!-- Botones -->
    <div class="d-flex justify-content-center gap-2 my-3">
      <button class="btn btn-primary" onclick="calcular()">Calcular</button>
      <button class="btn btn-secondary" onclick="limpiar()">Limpiar</button>
    </div>

    <!-- Notas -->
    <div class="alert alert-warning d-none" id="notaAnchor">
      <strong>Nota:</strong> Si la fecha de vencimiento indicada para la vitamina es menor a 9 meses contados desde la fecha de envasado, deber치 codificarse esa fecha como vencimiento del producto. En caso contrario, se debe codificar la fecha de vencimiento establecida por el Reglamento Sanitario, que corresponde a 9 meses a partir de la fecha de envasado.
    </div>

    <div class="alert alert-warning d-none" id="notaGloria">
      <strong>Nota:</strong> Si la fecha de vencimiento indicada para el granel es menor a 12 meses contados desde la fecha de envasado, deber치 codificarse esa fecha como vencimiento del producto. En caso contrario, se debe codificar la fecha de vencimiento establecida por el Reglamento Sanitario, que corresponde a 12 meses a partir de la fecha de envasado.
    </div>

    <!-- Resultado -->
    <div class="alert alert-success d-none" id="resultado"></div>
  </div>

  <div class="firma">Desarrollado por Jesus Espino</div>

  <script>
    function mostrarCampos() {
      const producto = document.getElementById("producto").value;
      document.getElementById("camposAnchor").classList.add("d-none");
      document.getElementById("camposGloria").classList.add("d-none");
      document.getElementById("resultado").classList.add("d-none");
      document.getElementById("notaAnchor").classList.add("d-none");
      document.getElementById("notaGloria").classList.add("d-none");

      if (producto === "Anchor") {
        document.getElementById("camposAnchor").classList.remove("d-none");
        document.getElementById("notaAnchor").classList.remove("d-none");
      } else if (producto === "Gloria") {
        document.getElementById("camposGloria").classList.remove("d-none");
        document.getElementById("notaGloria").classList.remove("d-none");
      }
    }

    function sumarMeses(fechaStr, meses) {
      const [anio, mes, dia] = fechaStr.split("-");
      const fecha = new Date(anio, mes - 1, dia);
      fecha.setMonth(fecha.getMonth() + meses);
      if (fecha.getDate() < dia) fecha.setDate(0);
      return fecha;
    }

    function formatearFecha(fecha) {
      const d = new Date(fecha);
      const dia = d.getDate().toString().padStart(2, '0');
      const mes = (d.getMonth() + 1).toString().padStart(2, '0');
      const anio = d.getFullYear();
      return `${dia}/${mes}/${anio}`;
    }

    function obtenerJuliano(fechaStr) {
      const fecha = new Date(fechaStr);
      const inicioA침o = new Date(fecha.getFullYear(), 0, 0);
      const diff = fecha - inicioA침o;
      const unDia = 1000 * 60 * 60 * 24;
      const diaJuliano = Math.floor(diff / unDia);
      return diaJuliano.toString().padStart(3, '0');
    }

    function calcular() {
      const producto = document.getElementById("producto").value;
      let fechaBase = "";
      let fechaVto = "";
      let mesesLimite = 0;

      if (producto === "Anchor") {
        fechaBase = document.getElementById("envasadoA").value;
        fechaVto = document.getElementById("vitaminaA").value;
        mesesLimite = 9;
      } else if (producto === "Gloria") {
        fechaBase = document.getElementById("fabricacionB").value;
        fechaVto = document.getElementById("conservanteB").value;
        mesesLimite = 12;
      } else {
        alert("Selecciona un producto");
        return;
      }

      if (!fechaBase || !fechaVto) {
        alert("Completa todas las fechas.");
        return;
      }

      if (fechaVto < fechaBase) {
        alert("La fecha de vencimiento no puede ser anterior a la fecha de envasado.");
        return;
      }

      const limite = sumarMeses(fechaBase, mesesLimite);
      const resultadoDiv = document.getElementById("resultado");
      let final = "";
      let detalle = "";

      if (new Date(fechaVto) <= limite) {
        final = fechaVto;
        detalle = `Debido a que la fecha de vencimiento ${producto === "Anchor" ? "de la vitamina" : "del granel"} es menor a ${mesesLimite} meses desde la fecha de envasado, se utilizar치 esta misma fecha para el codificado del producto.`;
      } else {
        final = limite.toISOString().split("T")[0];
        detalle = `La fecha ingresada del insumo supera los ${mesesLimite} meses respecto a la fecha de envasado. Se aplicar치 la fecha establecida por el Reglamento Sanitario (${mesesLimite} meses de vida util).`;
      }

      const juliano = obtenerJuliano(fechaBase);

      resultadoDiv.innerHTML = `
        <div class="resultado-bloque">
          <div class="etiqueta">游늱 Fecha de vencimiento del producto:</div>
          <div class="fecha-final">${formatearFecha(final)}</div>
        </div>
        <div class="resultado-bloque">
          <div class="etiqueta">游댝 D칤a Juliano del envasado:</div>
          <div class="fecha-final">${juliano}</div>
        </div>
        <p class="texto-detalle">${detalle}</p>
      `;
      resultadoDiv.classList.remove("d-none");
      document.getElementById("notaAnchor").classList.add("d-none");
      document.getElementById("notaGloria").classList.add("d-none");
    }

    function limpiar() {
      document.getElementById("producto").value = "";
      document.getElementById("camposAnchor").classList.add("d-none");
      document.getElementById("camposGloria").classList.add("d-none");
      document.getElementById("envasadoA").value = "";
      document.getElementById("vitaminaA").value = "";
      document.getElementById("fabricacionB").value = "";
      document.getElementById("conservanteB").value = "";
      document.getElementById("resultado").classList.add("d-none");
      document.getElementById("resultado").innerHTML = "";
      document.getElementById("notaAnchor").classList.add("d-none");
      document.getElementById("notaGloria").classList.add("d-none");
    }
  </script>
</body>
</html>
